
{literal}
<script language="JavaScript">
<!--
function validateNotesForm(f)
{
    if (isWhitespace(f.note.value)) {
        alert('Please enter the new note.');
        selectField(f, 'note');
        return false;
    }
    var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('', '_notes', features);
    popupWin.focus();
    return true;
}
function deleteNote(note_id)
{
    if (!confirm('This action will permanently delete the specified note.')) {
        return false;
    } else {
        var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
        var popupWin = window.open('popup.php?cat=delete_note&id=' + note_id, '_popup', features);
        popupWin.focus();
    }
}
//-->
</script>
{/literal}
<br />
<table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
<form name="add_note_form" target="_notes" onSubmit="javascript:return validateNotesForm(this);" method="post" action="{$rel_url}popup.php">
<input type="hidden" name="cat" value="add_note">
<input type="hidden" name="issue_id" value="{$smarty.get.id}">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2">
        <tr>
          <td class="default">
            <b>Internal Notes</b>
          </td>
          <td align="right" class="default">
            {if $browser.ie5up or $browser.ns6up or $browser.gecko}
            [ <a id="notes_link" class="link" href="javascript:void(null);" onClick="javascript:toggleVisibility('notes');">{get_innerhtml element_name="notes"}</a> ]
            {/if}
          </td>
        </tr>
        <tr id="notes1" {get_display_style element_name="notes"}>
          <td colspan="2">
            <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2">
              {section name="i" loop=$notes}
              {cycle values=$cycle assign="row_color"}
              <tr>
                <td align="center" bgcolor="{$cell_color}" class="default_white" width="220" nowrap>
                  {$notes[i].not_created_date}<br />
                  Posted by {$notes[i].usr_full_name}
                  {if $current_user_id == $notes[i].not_usr_id}
                  <br />[ <a class="white_link" href="javascript:void(null);" onClick="javascript:deleteNote({$notes[i].not_id});">delete</a> ]
                  {/if}
                </td>
                <td bgcolor="{$row_color}" width="100%" class="default" valign="top">
                  {$notes[i].not_note}
                </td>
              </tr>
              {sectionelse}
              <tr>
                <td colspan="2" bgcolor="{$light_color}" class="default" align="center">
                  <b>No notes could be found.</b>
                </td>
              </tr>
              {/section}
            </table>
          </td>
        </tr>
        {if $current_role > $roles.reporter}
        <tr id="notes2" {get_display_style element_name="notes"}>
          <td colspan="2" class="default">
            <b>Post New Internal Note:</b> <i>(Note will be sent only to staff persons displayed on the above notification list.)</i>
            <table width="100%">
              <tr>
                <td colspan="2" class="default" bgcolor="{$light_color}">
                  <textarea name="note" rows="8" style="width: 97%"></textarea>
                  {include file="error_icon.tpl.html" field="note"}
                </td>
              </tr>
              <tr>
                <td class="default_white" bgcolor="{$cell_color}">
                  <b>Extra Note Recipients:</b>
                </td>
                <td bgcolor="{$light_color}">
                  <select class="default" size="4" multiple name="note_cc[]">
                    {html_options options=$users}
                  </select> <span class="small_default"><i>(addresses will be added to issue notification list.)</i></span>
                </td>
              </tr>
              <tr>
                <td colspan="2" bgcolor="{$cell_color}" align="center">
                  <input type="submit" value="Post Note" class="button">
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {/if}
      </table>
    </td>
  </tr>
</form>
</table>

