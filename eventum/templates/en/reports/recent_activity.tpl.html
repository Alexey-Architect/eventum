{include file="header.tpl.html"}

<br />
<form method="post" action="{$smarty.server.PHP_SELF}" name="recent_activity">
<input type="hidden" name="cat" value="generate">
<table bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td bgcolor="{$cell_color}" colspan="2" class="default_white">
            <b>Recent Activity Report</b>
          </td>
        </tr>
        <tr>
          <td width="120" class="default">
            <b>Report Type:</b>
          </td>
          <td width="200" class="default" NOWRAP>
            <input type="radio" name="report_type" value="recent" class="default" {if $smarty.request.report_type!='range'}checked{/if} onClick="changeType('recent');">
                <a id="link" class="link" href="javascript:void(null)" 
                            onClick="javascript:checkRadio('recent_activity', 'report_type', 0);changeType('recent');">Recent</a>&nbsp;
            <input type="radio" name="report_type" value="range" {if $smarty.request.report_type=='range'}CHECKED{/if} onClick="changeType('range');">
                <a id="link" class="link" href="javascript:void(null)" 
                            onClick="javascript:checkRadio('recent_activity', 'report_type', 1);changeType('range');">Date Range</a>&nbsp;
          </td>
        </tr>
        <tr>
          <td width="120" class="default">
            <b>Activity Type:</b>
          </td>
          <td width="200" class="default">
            Phone Calls
          </td>
        </tr>
        <tr id="recent_row">
          <td width="120" class="default">
            <b>Activity in past:</b>
          </td>
          <td width="200">
            <input type="text" size="3" name="amount" value="{$amount|default:36}" class="default" style="text-align: right">&nbsp;
            <select name="unit" class="default">
                {html_options options=$units selected=$unit}
            </select>
          </td>
        </tr>
        <tr id="start_row">
          <td width="120" class="default">
            <b>Start:</b>
          </td>
          <td width="200">
            {html_select_date time=$start_date prefix="" field_array="start" start_year="-2" end_year="+1" field_order="YMD" month_format="%b" all_extra="class='default'"}
          </td>
        </tr>
        <tr id="end_row">
          <td width="120" class="default">
            <b>End:</b>
          </td>
          <td width="200">
            {html_select_date time=$end_date prefix="" field_array="end" start_year="-2" end_year="+1" field_order="YMD" month_format="%b" all_extra="class='default'"}
          </td>
        </tr>
        <tr>
          <td width="120" class="default">
            <b>Developer:</b>
          </td>
          <td width="200">
            <select class="default" name="developer">
                <option value="" label="All">All</option>
                {html_options options=$users selected=$developer}
            </select>
          </td>
        </tr>
        <tr>
          <td align="center" colspan="2">
            <input type="submit" value="Generate" class="shortcut">
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</form>
<script language="JavaScript">
{literal}
function changeType(type) {
    if (type == 'range') {
        document.getElementById('recent_row').style.display = 'none';
        document.getElementById('start_row').style.display = getDisplayStyle();
        document.getElementById('end_row').style.display = getDisplayStyle();
    } else {
        document.getElementById('recent_row').style.display = getDisplayStyle();
        document.getElementById('start_row').style.display = 'none';
        document.getElementById('end_row').style.display = 'none';
    }
}
{/literal}

changeType('{$smarty.request.report_type}');
</script>

{if $data != ''}
<table bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td bgcolor="{$cell_color}" colspan="{if $has_customer_integration}7{else}6{/if}" class="default_white">
            <b>Recent Phone Calls</b>
          </td>
        </tr>
        <tr>
          <td bgcolor="{$cell_color}" class="default_white">Issue ID</td>
          {if $has_customer_integration}
          <td bgcolor="{$cell_color}" class="default_white">Customer</td>
          {/if}
          <td bgcolor="{$cell_color}" class="default_white">Date</td>
          <td bgcolor="{$cell_color}" class="default_white">Developer</td>
          <td bgcolor="{$cell_color}" class="default_white">Type</td>
          <td bgcolor="{$cell_color}" class="default_white">Line</td>
          <td bgcolor="{$cell_color}" class="default_white">Description</td>
        </tr>
        {foreach from=$data item=row}
        {cycle values=$cycle assign="row_color"}
        <tr>
          <td class="default" bgcolor="{$row_color}" align="right">
            <a href="{$app_base_url}view.php?id={$row.phs_iss_id}" class="link">{$row.phs_iss_id}</a>
          </td>
          {if $has_customer_integration}
          <td class="default" bgcolor="{$row_color}">{$row.customer}</td>
          {/if}
          <td class="default" bgcolor="{$row_color}" nowrap>{$row.date}</td>
          <td class="default" bgcolor="{$row_color}">{$row.usr_full_name}</td>
          <td class="default" bgcolor="{$row_color}">{$row.phs_type}</td>
          <td class="default" bgcolor="{$row_color}">{$row.phc_title}</td>
          <td class="default" bgcolor="{$row_color}">{$row.phs_description|nl2br}</td>
        </tr>
        {foreachelse}
        <tr>
            <td colspan="7" class="default" align="center" bgcolor="{$dark_color}"><i>No Phone Calls Found</i></td>
        </tr>
        {/foreach}
      </table>
    </td>
  </tr>
</table>
{/if}
<br />
{include file="footer.tpl.html"}