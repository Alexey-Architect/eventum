
<script language="JavaScript">
<!--
var page_url = '{$smarty.server.PHP_SELF}';
var current_page = {$list_info.current_page};
var last_page = {$list_info.last_page};
{literal}
function assignItems(f)
{
    if (!hasOneChecked(f, 'item[]')) {
        alert('Please choose which entries to assign.');
        return false;
    }
    if (f.users.options[f.users.selectedIndex].value == '') {
        alert('Please choose the user to assign these entries to.');
        f.users.focus();
        selectField(f, 'users');
        return false;
    }
    var features = 'width=420,height=200,top=30,left=30,resizable=no,scrollbars=yes,toolbar=no,location=no,menubar=no,status=no';
    var popupWin = window.open('', '_popup', features);
    popupWin.focus();
    f.action = 'popup.php';
    f.target = '_popup';
    f.submit();
}
function hideClosed(f)
{
    if (f.hide_closed.checked) {
        window.location.href = page_url + "?" + replaceParam(window.location.href, 'hide_closed', '1');
    } else {
        window.location.href = page_url + "?" + replaceParam(window.location.href, 'hide_closed', '0');
    }
}
function resizePager(f)
{
    var pagesize = f.page_size.options[f.page_size.selectedIndex].value;
    window.location.href = page_url + "?" + replaceParam(window.location.href, 'rows', pagesize);
}
function checkPageField(ev)
{
    // check if the user is trying to submit the form by hitting <enter>
    if (((window.event) && (window.event.keyCode == 13)) ||
            ((ev) && (ev.which == 13))) {
        return false;
    }
}
function goPage(f, new_page)
{
    if ((new_page > last_page+1) || (new_page <= 0) ||
            (new_page == current_page+1) || (!isNumberOnly(new_page))) {
        f.page.value = current_page+1;
        return false;
    }
    setPage(new_page-1);
}
function setPage(new_page)
{
    if ((new_page > last_page) || (new_page < 0) ||
            (new_page == current_page)) {
        return false;
    }
    window.location.href = page_url + "?" + replaceParam(window.location.href, 'pagerRow', new_page);
}
function downloadCSV()
{
    var f = this.document.csv_form;
    f.submit();
    return false;
}
window.onload = disableFields;
function disableFields()
{
    var f = document.list_form;
    if (current_page == 0) {
        f.first.disabled = true;
        f.previous.disabled = true;
    }
    if ((current_page == last_page) || (last_page <= 0)) {
        f.next.disabled = true;
        f.last.disabled = true;
    }
    if ((current_page == 0) && (last_page <= 0)) {
        f.page.disabled = true;
        f.go.disabled = true;
    }
}
//-->
</script>
{/literal}
{* Figure out how many columns there are *}
{if $current_role != $roles.customer}
    {if $current_role > $roles.developer}
        {assign var="col_count" value="10"}
    {else}
        {assign var="col_count" value="9"}
    {/if}
    {if $groups|@count > 0}
        {math assign="col_count" equation="x+1" x=$col_count}
    {/if}
    {if $categories|@count > 0}
        {math assign="col_count" equation="x+1" x=$col_count}
    {/if}
{else}
    {assign var="col_count" value="9"}
{/if}
<table width="100%" bgcolor="{$cell_color}" border="0" cellspacing="0" cellpadding="1" align="center">
  <form name="list_form" method="post" action="{$smarty.server.PHP_SELF}">
  <input type="hidden" name="cat" value="assign">
  <tr>
    <td>
      <table bgcolor="#FFFFFF" width="100%" cellspacing="1" cellpadding="2" border="0">
        <tr>
          <td colspan="{math equation="x-2" x=$col_count}" class="default">
            <b>Search Results ({$list_info.total_rows} issues found{if $list_info.end_offset > 0}, {math equation="x + 1" x=$list_info.start_offset} - {$list_info.end_offset} shown{/if})</b>
            {include file="help_link.tpl.html" topic="list"}
          </td>
          {if $current_role != $roles.customer}
          <td colspan="2" align="right" class="default">
            {if $browser.ie5up or $browser.ns6up or $browser.gecko}
            hide/show:
            [ <a class="link" title="hide / show the quick search form" href="javascript:void(null);" onClick="javascript:toggleVisibility('filter_form');">quick search</a> ]
            [ <a class="link" title="hide / show the advanced search form" href="javascript:void(null);" onClick="javascript:toggleVisibility('custom_filter_form');">advanced search</a> ]
            {/if}
          </td>
          {/if}
        </tr>
        <tr bgcolor="{$cell_color}">
          {if $current_role > $roles.developer}
          <td width="1%">
            <input type="button" value="All" class="shortcut" onClick="javascript:toggleSelectAll(this.form, 'item[]');">
          </td>
          {/if}
          <td align="center" class="default_white" nowrap>
            <a title="sort by priority" href="{$sorting.links.iss_pri_id}" class="white_link">Priority</a>
            {if $sorting.images.iss_pri_id != ""}<a title="sort by priority" href="{$sorting.links.iss_pri_id}" class="white_link"><img border="0" src="{$sorting.images.iss_pri_id}"></a>{/if}
          </td>
          <td align="center" class="default_white" nowrap>
            <a title="sort by issue id" href="{$sorting.links.iss_id}" class="white_link">Issue ID</a>
            {if $sorting.images.iss_id != ""}<a title="sort by issue id" href="{$sorting.links.iss_id}" class="white_link"><img border="0" src="{$sorting.images.iss_id}"></a>{/if}
          </td>
          {if $current_role > $roles.customer && $groups|@count > 0}
          <td align="center" class="default_white" nowrap>Group</td>
          {/if}
          <td align="center" class="default_white">Assigned</td>
          {if $current_role != $roles.customer}
          <td align="center" class="default_white" nowrap>Time Spent</td>
          {/if}
          {if $categories|@count > 0}
          <td align="center" class="default_white" nowrap>
            <a title="sort by category" href="{$sorting.links.iss_prc_id}" class="white_link">Category</a>
            {if $sorting.images.iss_prc_id != ""}<a title="sort by category" href="{$sorting.links.iss_prc_id}" class="white_link"><img border="0" src="{$sorting.images.iss_prc_id}"></a>{/if}
          </td>
          {/if}
          {if $has_customer_integration}
          <td align="center" class="default_white" nowrap>
            <a title="sort by customer" href="{$sorting.links.iss_customer_id}" class="white_link">Customer</a>
            {if $sorting.images.iss_customer_id != ""}<a title="sort by customer" href="{$sorting.links.iss_customer_id}" class="white_link"><img border="0" src="{$sorting.images.iss_customer_id}"></a>{/if}
          </td>
          {/if}
          <td align="center" class="default_white" nowrap>
            <a title="sort by status" href="{$sorting.links.iss_sta_id}" class="white_link">Status</a>
            {if $sorting.images.iss_sta_id != ""}<a title="sort by status" href="{$sorting.links.iss_sta_id}" class="white_link"><img border="0" src="{$sorting.images.iss_sta_id}"></a>{/if}
          </td>
          <td align="center" class="default_white" nowrap>Status Change Date</td>
          <td align="center" class="default_white" nowrap>Last Action Date</td>
          <td width="30%">
            <table cellspacing="0" cellpadding="1" width="100%">
              <tr>
                <td class="default_white">
                  <a title="sort by summary" href="{$sorting.links.iss_summary}" class="white_link">Summary</a>
                  {if $sorting.images.iss_summary != ""}<a title="sort by summary" href="{$sorting.links.iss_summary}" class="white_link"><img border="0" src="{$sorting.images.iss_summary}"></a>{/if}
                </td>
                <td align="right">
                  <span class="default_white">Export Data:</span> <input alt="generate excel-friendly report" type="image" src="{$rel_url}images/excel.jpg" class="shortcut" value="Export to Excel" onClick="javascript:return downloadCSV();">
                </td>
              </tr>
            </table>
          </td>
        </tr>
        {section name="i" loop=$list}
        <tr {if $current_role > $roles.developer AND $list[i].iqu_status > 0}style="text-decoration : line-through;"{/if}>
          {if $current_role > $roles.developer}
          <td bgcolor="{$list[i].status_color}" width="1%" class="default" align="center"><input type="checkbox" name="item[]" value="{$list[i].iss_id}"></td>
          {/if}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].pri_title|escape:"html"}</td>
          <td bgcolor="{$list[i].status_color}" align="center" class="default"><a href="view.php?id={$list[i].iss_id}" class="link" title="view issue details">{$list[i].iss_id}</a></td>
          {if $current_role > $roles.customer && $groups|@count > 0}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].group}</td>
          {/if}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].assigned_users}</td>
          {if $current_role != $roles.customer}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].time_spent}</td>
          {/if}
          {if $categories|@count > 0}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].prc_title|escape:"html"}</td>
          {/if}
          {if $has_customer_integration}
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].customer_title|escape:"html"}</td>
          {/if}
          <td bgcolor="{$list[i].status_color}" align="center" class="default" width="8%">{$list[i].sta_title|escape:"html"}</td>
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].status_change_date|escape:"html"}</td>
          <td bgcolor="{$list[i].status_color}" align="center" class="default">{$list[i].last_action_date|escape:"html"}</td>
          <td bgcolor="{$list[i].status_color}" width="50%" class="default">
            <a href="view.php?id={$list[i].iss_id}" class="link" title="view issue details">{$list[i].iss_summary|escape:"html"}</a>
            {if $list[i].redeemed}
                [Redeemed]
            {/if}
            {if $list[i].iss_lock_usr_id != "" and $current_role != $roles.customer}
            <a href="view.php?id={$list[i].iss_id}" class="link" title="issue currently locked"><img src="images/icons/lock.gif" border="0"></a>
            {/if}
          </td>
        </tr>
        {sectionelse}
        <tr bgcolor="gray">
          <td colspan="{$col_count}" class="default_white" align="center">
            <i>No issues could be found.</i>
          </td>
        </tr>
        {/section}
        <tr bgcolor="{$cell_color}">
          <td colspan="{$col_count}">
            <table width="100%" cellspacing="0" cellpadding="0">
              <tr>
                <td width="30%" nowrap>
                  {if $current_role > $roles.developer}
                  <input type="button" value="All" class="shortcut" onClick="javascript:toggleSelectAll(this.form, 'item[]');">
                  <input type="button" value="Assign &gt;" class="shortcut" onClick="javascript:assignItems(this.form);">
                  <select name="users" class="default">
                    <option value=""></option>
                    {html_options options=$users}
                  </select>
                  {include file="error_icon.tpl.html" field="users"}
                  {/if}
                </td>
                <td width="40%" align="center" nowrap>
                  <nobr>
                  <input name="first" type="button" value="|&lt;" class="shortcut" onClick="javascript:setPage(0);">
                  <input name="previous" type="button" value="&lt;&lt;" class="shortcut" onClick="javascript:setPage({$list_info.previous_page});">
                  <input type="text" name="page" size="3" maxlength="3" value="{if $list_info.current_page == ''}1{else}{math equation="x + 1" x=$list_info.current_page}{/if}" style="background: {$cell_color};" class="paging_input" onKeyPress="javascript:return checkPageField(event);">
                  <input name="go" type="button" value="Go" class="shortcut" onClick="javascript:goPage(this.form, this.form.page.value);">
                  <input name="next" type="button" value="&gt;&gt;" class="shortcut" onClick="javascript:setPage({$list_info.next_page});">
                  <input name="last" type="button" value="&gt;|" class="shortcut" onClick="javascript:setPage({$list_info.last_page});">
                  </nobr>
                </td>
                <td nowrap>
                  <span class="default_white">Rows per Page:</span>
                  <select name="page_size" class="default" onChange="javascript:resizePager(this.form);">
                    <option value="5" {if $options.rows == 5}selected{/if}>5</option>
                    <option value="10" {if $options.rows == 10}selected{/if}>10</option>
                    <option value="25" {if $options.rows == 25}selected{/if}>25</option>
                    <option value="50" {if $options.rows == 50}selected{/if}>50</option>
                    <option value="100" {if $options.rows == 100}selected{/if}>100</option>
                    <option value="ALL" {if $options.rows == "ALL"}selected{/if}>ALL</option>
                  </select>
                  <input type="button" value="Set" class="shortcut" onClick="javascript:resizePager(this.form);">
                </td>
                <td width="30%" class="default_white" align="right">
                  <input type="checkbox" id="hide_closed" name="hide_closed" {if $options.hide_closed}checked{/if} onClick="javascript:hideClosed(this.form);"> <label for="hide_closed">Hide Closed Issues</label>&nbsp;
                </td>
              </tr>
            </table>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  </form>
  <form target="_csvWindow" method="post" action="csv.php" name="csv_form">
  <input type="hidden" name="csv_data" value="{$csv_data}">
  </form>
</table>

